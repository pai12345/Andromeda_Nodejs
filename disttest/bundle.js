!function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Error_Customer_enum=t.URL_enum=t.SQLQueryGenerator=t.MongoSchema_Enum=t.Status=void 0,function(e){e[e.Success=200]="Success",e[e.NotFound=404]="NotFound",e[e.ServerError=500]="ServerError",e[e.Unavailable=503]="Unavailable",e[e.BADREQUEST=400]="BADREQUEST",e.BADREQUESTMessage="Bad Request",e.ServerErrorMessage="Server Error",e.SuccessMessage="Success",e.ErrorMessage="Error",e.WebServerTitle="Web Server",e.WebServerBody="Microservice Web Server",e.PageNotFoundTitlte="Service Not Found",e.PageNotFoundBody="404 - Service Not Found",e.ListeningonPort="Listening on Port",e.NotResponding="Server did not response with any valid data",e.MongoDB_session_error="Mongo session error",e.Closing_http_server="Closing http server",e.Http_server_closed="Http server closed"}(t.Status||(t.Status={})),function(e){e.Customer="Customer"}(t.MongoSchema_Enum||(t.MongoSchema_Enum={})),function(e){e.GetCustomer_withFilter="SELECT (public.customers_getcustomer_function($1,$2)).*"}(t.SQLQueryGenerator||(t.SQLQueryGenerator={})),function(e){e.GraphQLEndpoint="/api/Andromeda"}(t.URL_enum||(t.URL_enum={})),function(e){e.Customer_UsernameEmpty="Username cannot be empty",e.Customer_UsernameInvalid="Enter valid username",e.Customer_PasswordInvalid="Enter valid password",e.Customer_InvalidEmailAddress="Invalid Email Address",e.Customer_Valid="Valid",e.Customer_Exist="Valid Customer",e.Customer_NotExist="Customer does not Exist",e.Customer_Email="Email",e.Customer_Empty="Empty",e.Customer_Length="Length",e.Customer_PasswordEmpty="Password cannot be empty",e.Customer_UnkowntypeforValidation="Unkown type for Validation",e.Customer_PasswordLength="Password should be more than 4 characters of length"}(t.Error_Customer_enum||(t.Error_Customer_enum={}))},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(13)),n=s(r(14)),u=s(r(15)),a=s(r(16)),i=r(0),l=s(r(17)),d=s(r(19)),c=s(r(20)),m=s(r(21));class _ extends o.default{constructor(){super(),this.Status=i.Status,this.Status}Validate_Data(e,t){switch(t){case i.Error_Customer_enum.Customer_Email:return n.default(e);case i.Error_Customer_enum.Customer_Empty:return u.default(e);case i.Error_Customer_enum.Customer_Length:return a.default(e,{min:4});default:throw new Error(i.Error_Customer_enum.Customer_UnkowntypeforValidation)}}GenerateMessage_graphql(e){var t;const r=Object.create(null),s=null!==(t=e.message)&&void 0!==t?t:i.Status.NotResponding;switch(s){case i.Error_Customer_enum.Customer_UsernameEmpty:return r.message=i.Error_Customer_enum.Customer_UsernameEmpty,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;case i.Error_Customer_enum.Customer_InvalidEmailAddress:return r.message=i.Error_Customer_enum.Customer_InvalidEmailAddress,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;case i.Error_Customer_enum.Customer_PasswordEmpty:return r.message=i.Error_Customer_enum.Customer_PasswordEmpty,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;case i.Error_Customer_enum.Customer_PasswordLength:return r.message=i.Error_Customer_enum.Customer_PasswordLength,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;case i.Error_Customer_enum.Customer_Valid:return r.message=i.Error_Customer_enum.Customer_Valid,r.statusCode=i.Status.Success,r.statusMessage=i.Status.SuccessMessage,r;case i.Error_Customer_enum.Customer_UsernameInvalid:return r.message=i.Error_Customer_enum.Customer_UsernameInvalid,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;case i.Error_Customer_enum.Customer_PasswordInvalid:return r.message=i.Error_Customer_enum.Customer_PasswordInvalid,r.statusCode=i.Status.BADREQUEST,r.statusMessage=i.Status.BADREQUESTMessage,r;default:return r.message=s,r.statusCode=i.Status.ServerError,r.statusMessage=i.Status.ServerErrorMessage,r}}async Query(e,t){const r=await l.default.connect();try{return(await r.query(e,t)).rows}catch(e){return e}finally{r.release()}}async CryptPassword(e){try{return d.default.hash(e,1)}catch(e){return e}}async CompareCryptPassword(e,t){try{return await d.default.compare(e,t)}catch(e){return e}}GenerateSecretKey(){return Math.random().toString(36)}GenerateCSRFToken(){const e=new c.default,t=e.secretSync();return{token:e.create(t),secret:t}}GenerateJWT(){const e=Math.random();return{token:m.default.sign({code:Math.random().toString(36)},""+e),secret:e}}ResultObj(e,t,r){return{status:e,message:t,data:r}}NullishCoalesce(e){return null!=e?e:i.Status.NotResponding}}const f=new _;t.default=f},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});s(r(5)).default.config();const o=process.env.PORT||8e3,n={PGUSER:process.env.PGUSER,PGHOST:process.env.PGHOST,PGPASSWORD:process.env.PGPASSWORD,PGDATABASE:process.env.PGDATABASE,PGPORT:process.env.PGPORT},u={MONGODB_URI:process.env.MONGODB_URI};t.default=()=>({env:"production",PORT:o,PostgreSQL:n,MongoDB:u})},function(e,t){e.exports=require("express")},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(29)),n=r(0),u=s(r(2)),a=s(r(30));class i extends a.default{constructor(){super(...arguments),this.Status=n.Status}async Connect_DB(){try{const e=u.default().MongoDB.MONGODB_URI;o.default.set("useUnifiedTopology",!0),o.default.set("useNewUrlParser",!0),o.default.set("useCreateIndex",!0);const t=o.default.connect(""+e);return await Promise.all([t]),{code:n.Status.Success,message:n.Status.SuccessMessage}}catch(e){return{code:n.Status.ServerError,message:""+e}}}Disconnect_DB(){o.default.disconnect()}Define_Schema(e){const{Schema:t}=o.default;return new t(e)}Define_Model(e,t,r){const{model:s}=o.default;return s(e,t,r)}}const l=new i;t.default=l},function(e,t){e.exports=require("dotenv")},function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=u(r(2)),i=n(r(3)),l=u(r(7)),d=u(r(8)),c=u(r(9)),m=u(r(10)),_=u(r(22)),f=u(r(23)),p=u(r(36)),g=r(0),S=a.default().PORT,E=i.default();E.set("trust proxy",1),E.use(i.json()),E.use(l.default({origin:["http://localhost:3000"],exposedHeaders:["x-auth-token","x-csrf-token"],credentials:!0})),E.use(d.default()),E.use(c.default()),E.use(m.default),E.use(_.default),E.use(f.default),E.use(p.default);const C=E.listen(S,()=>{console.log(`${g.Status.ListeningonPort}: ${S}`)});process.on("SIGTERM",()=>{console.log(g.Status.Closing_http_server),C.close(()=>{console.log(g.Status.Http_server_closed),process.exit(0)}),process.exit(0)})},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(11)),n=s(r(12)),u=s(r(1)),a=s(r(3)),i=s(r(2)),l=r(0),d=a.default(),c=i.default().MongoDB.MONGODB_URI,m=new(n.default(o.default))({uri:""+c,collection:"Session",connectionOptions:{useNewUrlParser:!0,useUnifiedTopology:!0}},e=>{e&&console.log(`${l.Status.MongoDB_session_error}:${e}`)}),_=d.use(o.default({secret:u.default.GenerateSecretKey(),resave:!1,saveUninitialized:!1,store:m,cookie:{maxAge:18e5,secure:!1,httpOnly:!0,sameSite:"strict"}}));m.on("error",e=>e),t.default=_},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("connect-mongodb-session")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},function(e,t){e.exports=require("validator/lib/isEmail")},function(e,t){e.exports=require("validator/lib/isEmpty")},function(e,t){e.exports=require("validator/lib/isLength")},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(18);s(r(5)).default.config();const n=s(r(2)),{PGUSER:u,PGPASSWORD:a,PGHOST:i,PGPORT:l,PGDATABASE:d}=n.default().PostgreSQL,c=`postgresql://${u}:${a}@${i}:${l}/${d}`,m=new o.Pool({connectionString:c});t.default=m},function(e,t){e.exports=require("pg")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("csrf")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(1));t.default=async(e,t,r)=>{try{return console.log(e),t.header("x-auth-token",o.default.GenerateJWT().token),t.header("x-csrf-token",o.default.GenerateCSRFToken().token),console.log(t),r()}catch(e){t.status(e.esponse.status).send(e),r()}}},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(24),n=s(r(25)),u=r(33),a=r(0),i=s(r(1)),l=s(r(3)).default().use(a.URL_enum.GraphQLEndpoint,o.graphqlHTTP({schema:u.typeDefs,rootValue:n.default,graphiql:!0,customFormatErrorFn:e=>i.default.GenerateMessage_graphql(e)}));t.default=l},function(e,t){e.exports=require("express-graphql")},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(26)),n={Login:async(e,t)=>await o.default(e,t),Logout:async(e,t)=>{try{return t.session.destroy(e=>e?"Session Deletion Error: "+e:(console.log("User sesssion deleted"),"User sesssion deleted")),{status:!0}}catch(e){return e}}};t.default=n},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(27)),n=s(r(1)),u=s(r(4)),a=r(0),i=s(r(31));t.default=async(e,t)=>{try{const r=o.default.Validate_GetCustomerDetails(e.input);if(r.username!==a.Error_Customer_enum.Customer_Valid){return n.default.ResultObj(a.Status.BADREQUEST,r.username,e.input.username)}if(r.password!==a.Error_Customer_enum.Customer_Valid){return n.default.ResultObj(a.Status.BADREQUEST,r.password,e.input.password)}{const r=await u.default.Connect_DB(),{code:s,message:o}=r;if(200===s){const{username:r,password:s}=e.input,o=i.default().Customer,l=await o.findOne({email:r}).select("_id customerid name title address email contactnumber dateofbirth password").lean();u.default.Disconnect_DB();if(n.default.NullishCoalesce(l)!==a.Status.NotResponding){if(!1===await n.default.CompareCryptPassword(s,l.password)){return n.default.ResultObj(a.Status.BADREQUEST,a.Error_Customer_enum.Customer_PasswordInvalid,null)}{const e={Customer:{email:r,Loggedin:!0,CSRF:{token:n.default.GenerateCSRFToken().token,secret:n.default.GenerateCSRFToken().secret},JWT:{token:n.default.GenerateJWT().token,secret:n.default.GenerateJWT().secret}}};t.session.data=e;return n.default.ResultObj(a.Status.Success,a.Status.SuccessMessage,l)}}return n.default.ResultObj(a.Status.NotFound,a.Error_Customer_enum.Customer_NotExist,null)}return n.default.ResultObj(a.Status.ServerError,a.Status.ServerErrorMessage,o)}}catch(e){return e}}},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(28)),n=s(r(1)),u=r(0);class a extends o.default{constructor(){super()}Validate_GetCustomerDetails(e){var t,r;const s=null!==(t=e.username)&&void 0!==t?t:u.Error_Customer_enum.Customer_UsernameInvalid,o=null!==(r=e.password)&&void 0!==r?r:u.Error_Customer_enum.Customer_PasswordInvalid,a=Object.create(null);switch(s){case u.Error_Customer_enum.Customer_UsernameInvalid:a.username=u.Error_Customer_enum.Customer_UsernameInvalid;break;default:if(n.default.Validate_Data(s,u.Error_Customer_enum.Customer_Empty)){a.username=u.Error_Customer_enum.Customer_UsernameEmpty;break}if(!1===n.default.Validate_Data(s,u.Error_Customer_enum.Customer_Email)){a.username=u.Error_Customer_enum.Customer_InvalidEmailAddress;break}a.username=u.Error_Customer_enum.Customer_Valid}switch(o){case u.Error_Customer_enum.Customer_PasswordInvalid:a.password=u.Error_Customer_enum.Customer_PasswordInvalid;break;default:if(n.default.Validate_Data(o,u.Error_Customer_enum.Customer_Empty)){a.password=u.Error_Customer_enum.Customer_PasswordEmpty;break}if(!1===n.default.Validate_Data(o,u.Error_Customer_enum.Customer_Length)){a.password=u.Error_Customer_enum.Customer_PasswordLength;break}a.password=u.Error_Customer_enum.Customer_Valid}return a}}const i=new a;t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},function(e,t){e.exports=require("mongoose")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(32)),n=s(r(4)).default.Define_Model("Customer",o.default().Customer,"Customer");t.default=()=>({Customer:n})},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(4)).default.Define_Schema({customerid:{type:Number,unique:!0},name:{type:String},title:{type:String,enum:["Mr","Ms","Mrs"]},address:{type:String},email:{type:String,required:!0,unique:!0},contactnumber:{type:Number},dateofbirth:{type:Date},password:{type:String,unique:!0,required:!0}});t.default=()=>({Customer:o})},function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.typeDefs=void 0;const o=r(34),n=s(r(35));t.typeDefs=o.buildASTSchema(n.default`
  #Schema - Root
  schema {
    query: RootQuery
  }

  #Root - Query Interface
  interface RootQuery_Interface {
    Login(input: LoginInput): LoginResponse!
    Logout(input: LoginOut): LogOutResponse!
  }

  #Root - Query Type
  type RootQuery implements RootQuery_Interface {
    Login(input: LoginInput): LoginResponse!
    Logout(input: LoginOut): LogOutResponse!
  }

  #Login - Input
  input LoginInput {
    username: String!
    password: String!
  }

  #Login - Response Interface
  interface LoginResponse_Interface {
    status: Int!
    message: String!
    data: LoginResponse_data
  }

  #Login - Response Type
  type LoginResponse implements LoginResponse_Interface {
    status: Int!
    message: String!
    data: LoginResponse_data
  }

  #Login - Response Type: data Interface
  interface LoginResponse_data_Interface {
    customerid: Int
    name: String
    title: String
    address: String
    email: String
    contactnumber: String
    dateofbirth: String
  }

  #Login - Response Type : data Type
  type LoginResponse_data implements LoginResponse_data_Interface {
    customerid: Int
    name: String
    title: String
    address: String
    email: String
    contactnumber: String
    dateofbirth: String
  }

  #Logout - Input
  input LoginOut {
    username: String!
  }

  #Logout - Response Interface
  interface LogOutResponse_Interface {
    status: Boolean!
  }

  #Logout - Response Type
  type LogOutResponse implements LogOutResponse_Interface {
    status: Boolean!
  }
`)},function(e,t){e.exports=require("graphql")},function(e,t){e.exports=require("graphql-tag")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0);t.default=async(e,t)=>{try{t.status(s.Status.NotFound).send(s.Status.PageNotFoundTitlte)}catch(e){t.status(e.esponse.status).send(e)}}}]);